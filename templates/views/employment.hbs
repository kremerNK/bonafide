<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/employment.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <title>Document</title>
</head>

<body>
    {{>nav}}
    <div id='wood-pane'>
        <p>Employment</p>
    </div>
    {{applicationSubmitted}}
    {{fileSubmitted}}
    {{#if applicationSubmitted}}
    <section class='application-submitted'>
        <p>Application successfully submitted, thank you!</p>
    </section>

    {{else}}

    {{#if messages}}
    <p>locals.messages showing up</p>
    <div id="flash-messages" class="container">
        {{#if messages.info}}
        <div class="alert alert-info">
            {{{flashMessages messages.info}}}
        </div>
        {{/if}}
        {{#if messages.success}}
        <div class="alert alert-success">
            {{{flashMessages messages.success}}}
        </div>
        {{/if}}
        {{#if messages.warning}}
        <div class="alert alert-warning">
            {{{flashMessages messages.warning}}}
        </div>
        {{/if}}
        {{#if messages.error}}
        <div class="alert alert-danger">
            {{!-- {{#each validationErrors}}
                            {{fieldLabel}}
                        {{/each}} --}}
            {{{flashMessages messages.error}}}

        </div>
        {{/if}}
    </div>
    {{/if}}
    <section class='employment-section'>
        <div class='employment-header'>
            <h3>Apply With Us Now</h3>
            <p>Bona Fide Juicery is looking for team members that are energetic,
                excited, and eager about promoting a healthy lifestyle.</p>
        </div>
        <div class='employment-form'>
            <form method="post" action="" enctype='multipart/form-data'>
                <input type="hidden" name="action" value="application">
                <div id='name'>


                    <p>Name <span style='color: #790000'>*</span></p>

                    <div id='testinggg'>
                        <span>
                            <input value='{{formData.firstname}}' name='firstname' id='firstname-input' type="text">
                            <label class='{{#if validationErrors.firstname}}has-error{{/if}}'
                                for="firstname-input">First</label>
                            {{!-- <p>First</p> --}}
                        </span>
                        <span>

                            <input value='{{formData.lastname}}' name='lastname' id='lastname-input' type="text">
                            <label class='{{#if validationErrors.lastname}}has-error{{/if}}'
                                for="lastname-input">Last</label>
                            {{!-- <p>Last</p> --}}
                        </span>
                    </div>


                </div>
                <div id='email'>
                    <p class='{{#if validationErrors.email}}has-error{{/if}}'>Email <span
                            style='color: #790000'>*</span></p>
                    <input value='{{formData.email}}' name='email' type="text">
                </div>
                <div id='phone'>
                    <p class='{{#if validationErrors.phone}}has-error{{/if}}'>Phone <span
                            style='color: #790000'>*</span></p>
                    <input value='{{formData.phone}}' id='phone-input' name='phone' type="text">
                </div>
                <div id='role'>
                    <p class='{{#if validationErrors.role}}has-error{{/if}}'>Job Role <span
                            style='color: #790000'>*</span></p>
                    <select value='{{formData.role}}' name="role" id="selectRole" multiple='multiple' size='4'>
                        <option id='role-option' value="Barista">Barista</option>
                        <option id='role-option' value="Juicer">Juicer/ Back of House (De Pere Only)</option>
                        <option id='role-option' value="Assistmanager">Assistant Manager</option>
                        <option id='role-option' value="Manager">Manager</option>
                    </select>
                </div>
                <div id='hours-available'>
                    <p class='{{#if validationErrors.hoursavailable}}has-error{{/if}}'>Hours Available</p>

                    <textarea name="hoursavailable" id=""
                        rows="10">{{#if formData.hoursavailable}}{{formData.hoursavailable}}{{/if}}</textarea>
                </div>
                <div id='pay'>
                    <p class='{{#if validationErrors.desiredpay}}has-error{{/if}}'>Desired Pay</p>
                    <input value='{{formData.desiredpay}}' name='desiredpay' type="text">
                </div>
                <div id='locations'>
                    <p class='{{#if validationErrors.locationsapplied}}has-error{{/if}}'>Locations Applied For <span
                            style='color: #790000'>*</span></p>
                    <select name="locationsapplied" id="" multiple='multiple' size='2'>
                        <option id='location-option' value="Depere">De Pere, WI</option>
                        <option id='location-option' value="Appleton">Appleton, WI</option>
                    </select>
                    <p>May select more than one</p>
                </div>
                <div id='start-date'>
                    <p class='{{#if validationErrors.startdate}}has-error{{/if}}'>Date Available to Start</p>
                    <input value='{{formData.startdate}}' name='startdate' type="date">
                </div>
                <div id='skills'>
                    <p class='{{#if validationErrors.coverletter}}has-error{{/if}}'>Cover Letter or Special Skills</p>
                    <textarea name="coverletter" id="test1"
                        rows="10">{{#if formData.coverletter}}{{formData.coverletter}}{{/if}}</textarea>
                </div>
                <div id='resume'>
                    <p class='{{#if validationErrors.resume}}has-error{{/if}}'>Resume Upload</p>
                    <input id='resume' name='resume' type="file">
                    {{!-- add type="file" --}}
                </div>
                <button onclick='uploadFile()'id='submit' type='submit'>Submit</button>

            </form>
        </div>
    </section>
    {{/if}}


    <h1>Upload a new file</h1>
    <form id="form2" action="/api/fileupload/create" method="POST" enctype='multipart/form-data'>
        <div>
            <input type="file" id="file_upload" />
            <br>
            <label for="file_name">Give the file a name:<input type="text" name="file_name" id="file_name" /></label>
        </div>
        <br>

        <div>
            <center><input type="button" value="Upload" onclick="uploadFile()"></center>
        </div>
    </form>
    <br>
    <div>
        <h2>Uploaded File List:</h2>
        <ul id="file_list">
        </ul>
    </div>
    {{>footer}}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src='/js/employment.js'></script>
    <script type='text/javascript'>
        $(document).ready(function () {
            //debugger;

        });

        function uploadFile() {
            //debugger;
            
            var selectedFile = $('#file_upload').get(0).files[0];

            //Error handling
            if (selectedFile == undefined)
                alert('You did not select a file!');

            //Create the FormData data object and append the file to it.
            var newFile = new FormData();
            newFile.append('file_upload', selectedFile); //This is the raw file that was selected

            //Set the form options.
            var opts = {
                url: '/api/fileupload/create',
                data: newFile,
                cache: false,
                contentType: false,
                processData: false,
                type: 'POST',

                //This function is executed when the file uploads successfully.
                success: function (data) {
                    //Dev Note: KeystoneAPI only allows file and image uploads with the file itself. Any extra metadata will have to
                    //be uploaded/updated with a second call.

                    //debugger;
                    console.log('File upload succeeded! ID: ' + data.file_upload._id);

                    //Fill out the file metadata information
                    data.file_upload.name = $('#file_name').val();
                    data.file_upload.url = '/uploads/files/' + data.file_upload.file.filename;
                    data.file_upload.fileType = data.file_upload.file.mimetype;
                    data.file_upload.createdTimeStamp = new Date();

                    //Update the file with the information above.
                    $.get('/api/fileupload/' + data.file_upload._id + '/update', data.file_upload, function (data) {
                        //debugger;

                        console.log('File information updated.');

                        //Add the uploaded file to the uploaded file list.
                        $('#file_list').append('<li><a href="' + data.collection.url + '" download>' + data.collection.name + '</a></li>');

                    })

                        //If the metadata update fails:
                        .fail(function (data) {
                            debugger;

                            console.error('The file metadata was not updated. Here is the error message from the server:');
                            console.error('Server status: ' + err.status);
                            console.error('Server message: ' + err.statusText);

                            alert('Failed to connect to the server while trying to update file metadata!');
                        });
                },

                //This error function is called if the POST fails for submitting the file itself.
                error: function (err) {
                    //debugger;

                    console.error('The file was not uploaded to the server. Here is the error message from the server:');
                    console.error('Server status: ' + err.status);
                    console.error('Server message: ' + err.statusText);

                    alert('Failed to connect to the server!');
                }
            };

            //Execute the AJAX call.
            jQuery.ajax(opts);

        }
    </script>
</body>

</html>